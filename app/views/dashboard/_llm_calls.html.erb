<% llm_calls.each do |llm_call| %>
  <div id="<%= dom_id(llm_call) %>" class="dashboard-card llm-call-card">
    <div class="flex justify-between items-start">
      <h3 class="text-lg font-medium"><%= llm_call.model || "Unknown Model" %></h3>
      <span class="text-xs text-gray-500"><%= time_ago_in_words(llm_call.created_at) %> ago</span>
    </div>
    <div class="card-details mt-2">
      <p><strong>Provider:</strong> <%= llm_call.provider || "Unknown" %></p>
      <p><strong>Agent:</strong> 
        <% if llm_call.agent_activity %>
          <%= link_to llm_call.agent_activity.agent_type, agent_activity_path(llm_call.agent_activity), class: "text-blue-600 hover:underline" %>
        <% else %>
          N/A
        <% end %>
      </p>
      <p><strong>Tokens:</strong> <%= llm_call.tokens_used || 0 %></p>
    </div>
    
    <div class="mt-3">
      <button class="text-blue-600 text-sm flex items-center" 
              data-controller="collapsible"
              data-action="click->collapsible#toggle" 
              data-collapsible-target="trigger"
              data-id="llm-details-<%= llm_call.id %>">
        <span>View Prompt & Response</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>
      
      <div id="llm-details-<%= llm_call.id %>" class="hidden mt-3 bg-gray-50 p-3 rounded text-sm">
        <div class="mb-3">
          <h4 class="font-medium mb-1">Prompt:</h4>
          <pre class="whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-40 overflow-y-auto"><%= llm_call.prompt %></pre>
        </div>
        <div>
          <h4 class="font-medium mb-1">Response:</h4>
          <pre class="whitespace-pre-wrap bg-white p-2 rounded border border-gray-200 max-h-40 overflow-y-auto"><%= llm_call.response %></pre>
        </div>
      </div>
    </div>
  </div>
<% end %>
