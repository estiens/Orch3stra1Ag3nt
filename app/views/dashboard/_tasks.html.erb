<% tasks.each do |task| %>
  <div id="<%= dom_id(task) %>" class="dashboard-card task-card <%= task.state %>">
    <div class="flex justify-between items-start">
      <h3 class="text-lg font-medium">
        <%= link_to task.title, project_task_path(task.project, task), class: "hover:text-blue-600 hover:underline" %>
      </h3>
      <%= status_badge(task.state) %>
    </div>
    <div class="card-details mt-2">
      <% if task.project %>
        <p><strong>Project:</strong> <%= link_to task.project.name, project_path(task.project), class: "text-blue-600 hover:underline" %></p>
      <% end %>
      <p><strong>Type:</strong> <%= task.task_type.humanize %></p>
      <p><strong>Created:</strong> <%= time_ago_in_words(task.created_at) %> ago</p>
      <% if task.agent_activities.any? %>
        <p><strong>Activities:</strong> <%= task.agent_activities.count %></p>
      <% end %>
      <% if task.description.present? %>
        <p class="mt-2 text-gray-600 line-clamp-2"><%= task.description %></p>
      <% end %>
    </div>
    <div class="card-actions mt-3 flex justify-between items-center">
      <div>
        <%= link_to "View Details", project_task_path(task.project, task), class: "text-blue-600 text-sm hover:underline" %>
      </div>
      <div>
        <% if task.pending? %>
          <%= button_to "Start", activate_task_path(task), method: :post, class: "button button-success" %>
        <% elsif task.active? %>
          <%= button_to "Pause", pause_task_path(task), method: :post, class: "button button-warning" %>
        <% elsif task.paused? %>
          <%= button_to "Resume", activate_task_path(task), method: :post, class: "button button-success" %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
